import{r as x,j as e,H,L as d,a as p}from"./app-CX5FMW1s.js";import{A as W}from"./AdminLayout-Bv6JVXqp.js";const P={planning:"bg-yellow-100 text-yellow-800",active:"bg-green-100 text-green-800",completed:"bg-blue-100 text-blue-800",paused:"bg-orange-100 text-orange-800",cancelled:"bg-red-100 text-red-800"},z={planning:"في التخطيط",active:"نشط",completed:"مكتمل",paused:"متوقف مؤقت",cancelled:"ملغى"},D={sales:"مبيعات",subscription:"اشتراكات",free:"مجاني",downloads:"تحميلات"},I={not_displayed:"لم يعرض",published:"منشور",unpublished:"مغلق"},T={not_displayed:"bg-gray-100 text-gray-800",published:"bg-green-100 text-green-800",unpublished:"bg-red-100 text-red-800"};function q({projects:c}){const[u,N]=x.useState(""),[j,o]=x.useState(!1),[n,f]=x.useState(null),[m,b]=x.useState(""),w=s=>{p.patch(`/admin/projects/${s}/quick-sale`,{},{preserveScroll:!0,onSuccess:()=>{}})},k=s=>{f(s),b(""),o(!0)},_=()=>{if(!n)return;const s=m?{plan_id:m}:{};p.patch(`/admin/projects/${n.id}/quick-subscriber`,s,{preserveScroll:!0,onSuccess:()=>{o(!1),f(null),b("")}})},h=s=>{let t=0;switch(s.type){case"sales":t=(Number(s.product_price)||0)*(Number(s.sales_count)||0);break;case"subscription":s.subscription_plans&&s.subscription_plans.length>0?t=s.subscription_plans.reduce((r,a)=>{const i=Number(a.price)||0,M=Number(a.subscriber_count)||0,B=a.billing_cycle==="yearly"?12:(a.billing_cycle==="lifetime",1);return r+i*M*B},0):t=Number(s.calculated_revenue)||Number(s.total_revenue)||0;break;case"downloads":s.platform_stats&&s.platform_stats.length>0?t=s.platform_stats.reduce((r,a)=>r+(Number(a.revenue)||0),0):t=Number(s.total_revenue)||0;break;case"free":default:t=0}return Number(t)||0},L=s=>s.type!=="subscription"||!s.subscription_plans?0:s.subscription_plans.reduce((t,r)=>t+(r.subscriber_count||0),0),y=s=>{const t=h(s)||0,r=s.expenses?.reduce((a,i)=>a+(i.amount||0),0)||0;return t-r},C=s=>{const t=Number(s.initial_budget)||0,r=s.budgets?s.budgets.reduce((a,i)=>a+(Number(i.amount)||0),0):0;return s.id===1&&console.log("Project Debug:",{id:s.id,initial_budget:s.initial_budget,budgets:s.budgets,total:t+r}),t+r},l=s=>{const t=Number(s)||0;return new Intl.NumberFormat("en-US",{style:"currency",currency:"IQD",minimumFractionDigits:0}).format(t)},g=s=>s?new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric"}).format(new Date(s)):"غير محدد",S=s=>{confirm("هل أنت متأكد من حذف هذا المشروع؟")&&p.delete(route("admin.projects.destroy",s))},v=c.data.filter(s=>s.name.toLowerCase().includes(u.toLowerCase())||s.manager?.name.toLowerCase().includes(u.toLowerCase()));return e.jsxs(W,{children:[e.jsx(H,{title:"إدارة المشاريع"}),e.jsx("div",{className:"min-h-screen bg-gray-50/80 px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"إدارة المشاريع"}),e.jsx("p",{className:"text-gray-600",children:"إدارة المشاريع والميزانيات والتقارير المالية"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"البحث في المشاريع...",value:u,onChange:s=>N(s.target.value),className:"w-full sm:w-64 pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("svg",{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),e.jsxs(d,{href:route("admin.projects.create"),className:"inline-flex items-center justify-center px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-medium rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-sm",children:[e.jsx("svg",{className:"ml-2 h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"إضافة مشروع جديد"]})]})]})}),v.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx("svg",{className:"mx-auto h-16 w-16 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"لا توجد مشاريع"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"ابدأ بإضافة أول مشروع لك"}),e.jsx(d,{href:route("admin.projects.create"),className:"inline-flex items-center px-4 py-2 bg-blue-500 text-white font-medium rounded-lg hover:bg-blue-600 transition-colors",children:"إضافة مشروع جديد"})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:v.map(s=>e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow duration-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["نوع المشروع: ",D[s.type]]})]}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${P[s.status]}`,children:z[s.status]})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-4 line-clamp-2",children:s.description}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"إجمالي الميزانية"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:l(C(s))})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"إجمالي المصروفات"}),e.jsx("p",{className:"text-sm font-semibold text-red-600",children:l(s.expenses?s.expenses.reduce((t,r)=>t+(Number(r.amount)||0),0):0)})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"صافي الربح"}),e.jsx("p",{className:`text-sm font-semibold ${y(s)>=0?"text-green-600":"text-red-600"}`,children:l(y(s))})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"مدير المشروع"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.manager?.name||"غير محدد"})]}),e.jsxs("div",{className:"mb-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"بداية التطوير:"}),e.jsx("span",{children:g(s.development_start_date)})]}),s.development_end_date&&e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("span",{children:"انتهاء التطوير:"}),e.jsx("span",{children:g(s.development_end_date)})]}),s.publication_date&&e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("span",{children:"تاريخ النشر:"}),e.jsx("span",{children:g(s.publication_date)})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${T[s.publication_status]}`,children:I[s.publication_status]})}),s.platforms_count>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:["المنصات (",s.platforms_count,")"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.platforms?.slice(0,3).map((t,r)=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:t.platform},r)),s.platforms?.length>3&&e.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full",children:["+",s.platforms.length-3]})]})]}),s.type==="sales"&&e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["المبيعات: ",s.sales_count||0]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["سعر المنتج: ",l(s.product_price||0)]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["إجمالي الإيرادات: ",l(h(s))]}),e.jsxs("button",{onClick:()=>w(s.id),className:"inline-flex items-center px-2 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600 transition-colors",children:[e.jsx("svg",{className:"ml-1 h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"إضافة مبيعة"]})]})]}),s.type==="subscription"&&e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["إجمالي المشتركين: ",L(s)]}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["إيرادات شهرية: ",l(h(s))]})]}),e.jsxs("button",{onClick:()=>k(s),className:"inline-flex items-center px-2 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:[e.jsx("svg",{className:"ml-1 h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"إضافة مشترك"]})]}),s.type==="downloads"&&e.jsx("div",{className:"mb-4 pb-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["التحميلات: ",s.downloads_count||0]}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["إجمالي الإيرادات: ",l(s.total_revenue||0)]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(d,{href:route("admin.projects.show",s.id),className:"inline-flex items-center px-3 py-1.5 text-sm text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-md transition-colors",children:[e.jsxs("svg",{className:"ml-1 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"عرض"]}),e.jsxs(d,{href:route("admin.projects.edit",s.id),className:"inline-flex items-center px-3 py-1.5 text-sm text-amber-600 hover:text-amber-700 hover:bg-amber-50 rounded-md transition-colors",children:[e.jsx("svg",{className:"ml-1 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"تعديل"]}),e.jsxs("button",{onClick:()=>S(s.id),className:"inline-flex items-center px-3 py-1.5 text-sm text-red-600 hover:text-red-700 hover:bg-red-50 rounded-md transition-colors",children:[e.jsx("svg",{className:"ml-1 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"حذف"]})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.expenses_count," مصروف | ",s.budgets_count," ميزانية"]})]})]})},s.id))}),c.links&&c.links.length>3&&e.jsx("div",{className:"mt-8 flex items-center justify-center",children:e.jsx("nav",{className:"flex items-center space-x-1 space-x-reverse",children:c.links.map((s,t)=>e.jsx(d,{href:s.url,className:`px-3 py-2 text-sm rounded-md transition-colors ${s.active?"bg-blue-500 text-white":s.url?"text-gray-700 hover:bg-gray-100":"text-gray-400 cursor-not-allowed"}`,dangerouslySetInnerHTML:{__html:s.label}},t))})})]})}),j&&n&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"إضافة مشترك جديد"}),e.jsx("button",{onClick:()=>o(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["المشروع: ",e.jsx("span",{className:"font-medium",children:n.name})]}),n.subscription_plans&&n.subscription_plans.length>0?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"اختر الباقة:"}),e.jsx("div",{className:"space-y-2",children:n.subscription_plans.map(s=>e.jsxs("label",{className:"flex items-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"plan",value:s.id,checked:m==s.id,onChange:t=>b(t.target.value),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("span",{className:"text-sm text-gray-600",children:l(s.price)})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:s.billing_cycle==="monthly"?"شهري":s.billing_cycle==="yearly"?"سنوي":"مدى الحياة"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["المشتركين: ",s.subscriber_count||0]})]})]})]},s.id))})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-gray-500",children:"لا توجد باقات اشتراك لهذا المشروع"})})]}),e.jsxs("div",{className:"flex justify-end space-x-2 space-x-reverse",children:[e.jsx("button",{onClick:()=>o(!1),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"إلغاء"}),e.jsx("button",{onClick:_,disabled:n.subscription_plans&&n.subscription_plans.length>0&&!m,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"إضافة مشترك"})]})]})})})]})}export{q as default};
